package Network;

import java.util.HashMap;  
import java.util.Map;

public class Topology {
	
	private Map<String, Map<String, Device>> devicePortMap = new HashMap<>();

	public void registerDevice(Device device) {
	    Map<String, Device> portMap = new HashMap<>();
	    for (int i = 0; i < device.getTotalPorts(); i++) {
	        portMap.put("Fa0/" + i, null);
	    }
	    devicePortMap.put(device.getName(), portMap);
	}

	public boolean connectDevices(Device source, Device target) {
	    Map<String, Device> sourcePorts = devicePortMap.get(source.getName());
	    String availablePort = sourcePorts.entrySet().stream()
	        .filter(e -> e.getValue() == null)
	        .map(Map.Entry::getKey)
	        .findFirst()
	        .orElse(null);

	    if (availablePort == null) {
	        System.out.println(source.getName() + " has no available ports.");
	        return false;
	    }

	    sourcePorts.put(availablePort, target);
	    System.out.println(target.getName() + " connected to " + source.getName() + " on Port " + availablePort);
	    return true;
	}

	public void printNetworkTopology() {
        System.out.println("\nNetwork Topology (Port Connections):");
        for (Map.Entry<String, Map<String, Device>> entry : devicePortMap.entrySet()) {
            String deviceName = entry.getKey();
            Map<String, Device> ports = entry.getValue();
            System.out.println("\nDevice: " + deviceName);
            System.out.println("+--------+-------------------+");
            System.out.println("| Port   | Connected Device   |");
            System.out.println("+--------+-------------------+");
            for (Map.Entry<String, Device> portEntry : ports.entrySet()) {
                String port = portEntry.getKey();
                Device connectedDevice = portEntry.getValue();
                String connectedName = (connectedDevice != null) ? connectedDevice.getName() : "Empty";
                System.out.printf("| %-6s | %-17s |\n", port, connectedName);
            }
            System.out.println("+--------+-------------------+\n");
        }
    }
}
