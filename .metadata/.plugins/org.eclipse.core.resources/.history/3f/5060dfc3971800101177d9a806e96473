package Network;

import java.util.HashMap;  
import java.util.Map;

public class Topology {
	private Map<String, Map<String, String>> connections;
	
	private Map<String, Map<String, Device>> networkTopology = new HashMap<>();

	public void registerDevice(Device device) {
	    Map<String, Device> portMap = new HashMap<>();
	    for (int i = 0; i < device.getTotalPorts(); i++) {
	        portMap.put("Fa0/" + i, null);
	    }
	    networkTopology.put(device.getName(), portMap);
	}

	public boolean connectDevices(Device source, Device target) {
	    Map<String, Device> sourcePorts = networkTopology.get(source.getName());
	    String availablePort = sourcePorts.entrySet().stream()
	        .filter(e -> e.getValue() == null)
	        .map(Map.Entry::getKey)
	        .findFirst()
	        .orElse(null);

	    if (availablePort == null) {
	        System.out.println(source.getName() + " has no available ports.");
	        return false;
	    }

	    sourcePorts.put(availablePort, target);
	    System.out.println(target.getName() + " connected to " + source.getName() + " on Port " + availablePort);
	    return true;
	}


	public Topology() {
        this.connections = new HashMap<>();
    }

    public void addConnection(String device1, String device2, String port1, String port2) {
        connections.putIfAbsent(device1, new HashMap<>());
        connections.putIfAbsent(device2, new HashMap<>());

        connections.get(device1).put(device2, port1);
        connections.get(device2).put(device1, port2);
    }

    public void printDeviceConnections(String deviceName) {
        if (!connections.containsKey(deviceName)) {
            System.out.println("No connections found for " + deviceName);
            return;
        }

        System.out.println("\nConnections for " + deviceName + ":");
        System.out.println("+-------------------+------------+");
        System.out.println("| Connected Device  | Port       |");
        System.out.println("+-------------------+------------+");

        for (Map.Entry<String, String> entry : connections.get(deviceName).entrySet()) {
            System.out.printf("| %-17s | %-10s |\n", entry.getKey(), entry.getValue());
        }

        System.out.println("+-------------------+------------+\n");
    }

    public void printNetworkTopology() {
        System.out.println("\nNetwork Topology:");
        for (String device : connections.keySet()) {
            printDeviceConnections(device);
        }
    }
}
