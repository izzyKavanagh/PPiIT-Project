package Menus;

import java.util.List;
import java.util.Map;
import java.util.Scanner;

import Devices.Computer;
import Network.DHCPServer;
import Network.IPPool;
import Network.NetworkManager;

public class PCMenu {
	
	public static void managePCs(Scanner scanner, DHCPServer dhcpServer, List<Computer> computers, NetworkManager manager) {
		
		 while (true) {
			 System.out.println("\n===== PC Management =====");
	         for (int i = 0; i < computers.size(); i++) 
	         {
	        	 Computer pc = computers.get(i);
	        	 
	        	 System.out.print((i + 1) + ". " + pc.getName() + " (IP: ");
	        	 
	        	 if (pc.getIpAddress() == null) 
	        	 {
	        		    System.out.print("Not Assigned");
	        	 } 
	        	 else 
	        	 {
	        		 System.out.print(pc.getIpAddress());
	        	 }
	        	 
	        	 System.out.print(", DHCP: ");

	        	 if (!pc.staticIP) 
	        	 {
	        		 System.out.println("Enabled)");
	        	 } 
	        	 else 
	        	 {
	        		 System.out.println("Disabled)");
	        	 }
	         }
	         
	         System.out.println((computers.size() + 1) + ". Return to Main Menu");
	         System.out.print("Select a PC to manage: ");

	         int pcChoice = scanner.nextInt();
	         scanner.nextLine(); // Consume newline

	         if (pcChoice == computers.size() + 1) return; // Return to main menu

	         if (pcChoice < 1 || pcChoice > computers.size()) 
	         {
	        	 System.out.println("Invalid selection! Try again.");
	             continue;
	         }

	         Computer selectedPC = computers.get(pcChoice - 1);
	         configurePC(scanner, dhcpServer, selectedPC, manager);
	     }
	}

	private static void configurePC(Scanner scanner, DHCPServer dhcpServer, Computer pc, NetworkManager manager) {
		
		System.out.println("\nManaging " + pc.getName());
		
		System.out.print("Current IP: ");
		
		if (pc.getIpAddress() == null) {
		    System.out.println("Not Assigned");
		} 
		else 
		{
		    System.out.println(pc.getIpAddress());
		}

		System.out.print("DHCP Enabled: ");
		
		if (!pc.staticIP) 
		{
		    System.out.println("Yes");
		} 
		else 
		{
		    System.out.println("No");
		}

       System.out.println("1. Enable DHCP");
       System.out.println("2. Disable DHCP (Use Static IP)");
       System.out.println("3. Return to PC Menu");
       System.out.print("Enter your choice: ");

       int choice = scanner.nextInt();
       scanner.nextLine(); // Consume newline

       switch (choice) {
           case 1:
           	Map<String, IPPool> pools = dhcpServer.getPools(); // Assuming this method exists

               if (pools.isEmpty()) 
               {
                   System.out.println("No available IP Pools.");
                   return;
               }
               
           	String helperIP = manager.findLayer3Device(pc);
           	
           	if(helperIP == null)
           	{
           		return;
           	}
           	
           	manager.findDHCPServer(pc, pc.getGatewayIp(), helperIP);
               
               pc.staticIP = false;
               
               System.out.println(pc.getName() + " is now using DHCP with IP: " + pc.getIpAddress());
               break;

           case 2:
           	pc.staticIP = true;
           	manager.useStaticIpAllocation(pc);
               System.out.println(pc.getName() + " is now using Static IP.");
               break;

           case 3:
               return;

           default:
               System.out.println("Invalid choice! Try again.");
       }
		
	}
}
